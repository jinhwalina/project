<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <!-- 외래키는 꼭 속성안에 넣어주기 -->
<mapper namespace="kr.green.project.dao.InnDao">
	<!-- pet 정보를 넣어줌 ! -->
	<insert id="insertPet" parameterType="kr.green.project.Vo.PetVo" useGeneratedKeys="true" keyProperty="pet.petnum">
		insert into 
				pet(pname, pgender, pino, psur, pcau, ptype) 
				values(#{pet.pname},#{pet.pgender},#{pet.pino},#{pet.psur},#{pet.pcau},#{pet.ptype})
	</insert>
	
	<!-- inn정보를 넣어줌. 로그인 한 정보를 불러와서 자동 등록 되는거 말고도, 추가로 변경한 이른 연락처도 들어가게끔 -->
	<insert id="insertInn">
		insert into
				inn(inn_st_date, inn_service, inn_time, inn_add_name, inn_add_num ,inn_user_mail, inn_petnum, inn_total_price)
				values(#{inn.inn_st_date},#{inn.inn_service},#{inn.inn_time},#{inn.inn_add_name},#{inn.inn_add_num},#{inn.inn_user_mail},#{inn.inn_petnum},#{inn.inn_total_price})
	</insert>
	
	<select id="getDates" resultType="kr.green.project.Vo.DateVo">
	
		SELECT inn_st_date as st_date, DATE_ADD(inn_st_date, INTERVAL (inn_time-1) DAY) as end_date  FROM hotel.inn where (select DATE_ADD(inn_st_date, INTERVAL (inn_time-1) DAY)) >= #{strdate} and  #{strdate} >= inn_st_date  	
	</select>
	
	<select id="getMyInn" resultType="kr.green.project.dto.mypageDto">
		select * from 
				inn
					join pet
						on inn.inn_petnum = pet.petnum
						where inn_user_mail = #{mail}
							and inn_st_date >= #{today}
							order by inn_st_date asc
													
	</select>

	
</mapper>
